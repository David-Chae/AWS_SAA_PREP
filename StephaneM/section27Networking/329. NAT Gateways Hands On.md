## 1ï¸âƒ£ ë¬¸ì œ ìƒí™©: ê°‘ìê¸° ì¸í„°ë„·ì´ ì•ˆ ëœë‹¤

### ğŸ”´ ë¬´ìŠ¨ ì¼ì´ ë²Œì–´ì¡Œë‚˜?

* ê¸°ì¡´ì— ì“°ë˜ **NAT Instanceë¥¼ Stop / Terminate**
* Private Subnetì˜ EC2ì—ì„œ:

```bash
curl google.com
```

ğŸ‘‰ âŒ ì‹¤íŒ¨
ğŸ‘‰ ì¸í„°ë„· ì™„ì „ ì°¨ë‹¨

---

## 2ï¸âƒ£ ì›ì¸: Private Route Tableì˜ â€œBlack Holeâ€

### ğŸ” Route Table í™•ì¸

Private Subnetì˜ Route Tableì„ ë³´ë©´:

* ëŒ€ìƒ(Target): **NAT Instanceì˜ ENI**
* ìƒíƒœ: **Black hole**

### ğŸ•³ Black Holeì´ë€?

> **ë¼ìš°íŒ… ëŒ€ìƒì´ ì‚¬ë¼ì ¸ì„œ íŠ¸ë˜í”½ì´ ê°ˆ ê³³ì´ ì—†ëŠ” ìƒíƒœ**

* NAT Instanceê°€ ë©ˆì¶¤
* ì—°ê²°ëœ ENIë„ ë¹„í™œì„±
* í•˜ì§€ë§Œ Route Tableì€ ì—¬ì „íˆ ê·¸ìª½ìœ¼ë¡œ ë³´ëƒ„

ğŸ‘‰ ê²°ê³¼:
**íŠ¸ë˜í”½ì´ í—ˆê³µìœ¼ë¡œ ì‚¬ë¼ì§**

ğŸ“Œ ì´ê²Œ NAT Instanceì˜ ëŒ€í‘œì ì¸ ë‹¨ì 

---

## 3ï¸âƒ£ í•´ê²° ì „ëµ: NAT Gatewayë¡œ êµì²´

> **â€œì¸ìŠ¤í„´ìŠ¤ì— ì˜ì¡´í•˜ì§€ ë§ê³ , AWS ê´€ë¦¬ ì„œë¹„ìŠ¤ë¡œ ë°”ê¾¸ìâ€**

---

## 4ï¸âƒ£ NAT Gateway ìƒì„±

### ğŸ›  ìƒì„± ì •ë³´

* ì´ë¦„: `DemoNATGW`
* Subnet: **Public Subnet**

  * ì˜ˆ: `PublicSubnetA`
* Connectivity type: **Public**
* Elastic IP: **ìƒˆë¡œ í• ë‹¹**

ğŸ‘‰ NAT GatewayëŠ”:

* Public Subnet í•„ìˆ˜
* Elastic IP í•„ìˆ˜
* Internet Gateway ì—°ê²° í•„ìˆ˜

---

### â³ ìƒì„± ì¤‘ ìƒíƒœ

* ì²˜ìŒì—” `Pending`
* ì ì‹œ í›„ `Active`ë¡œ ë³€ê²½ë¨

---

## 5ï¸âƒ£ Private Route Table ìˆ˜ì • (í•µì‹¬)

### ğŸ”„ ê¸°ì¡´ ë¬¸ì œ ê²½ë¡œ ì œê±°

* âŒ `0.0.0.0/0 â†’ NAT Instance (Black hole)`

### âœ… ìƒˆ ê²½ë¡œ ì¶”ê°€

```
Destination: 0.0.0.0/0
Target: DemoNATGW
```

ğŸ‘‰ ì´ì œ Private Subnetì˜ ëª¨ë“  ì¸í„°ë„· íŠ¸ë˜í”½ì€
**NAT Gatewayë¡œ ì´ë™**

---

## 6ï¸âƒ£ NAT Gateway í™œì„±í™” í›„ íš¨ê³¼

* NAT Gatewayê°€ `Active` ìƒíƒœê°€ ë˜ë©´
* Private EC2ëŠ” ìë™ìœ¼ë¡œ ì¸í„°ë„· ê°€ëŠ¥

---

## 7ï¸âƒ£ ì¸í„°ë„· ì—°ê²° í™•ì¸

Private Subnet EC2ì—ì„œ:

```bash
ping google.com
curl google.com
```

ğŸ‘‰ âœ… ì‘ë‹µ ì •ìƒ

ë˜ëŠ”:

```bash
sudo yum update
```

ğŸ‘‰ OS ì—…ë°ì´íŠ¸ ì„±ê³µ
ğŸ‘‰ **Public IP ì—†ì´ë„ ì¸í„°ë„· ê°€ëŠ¥**

---

## 8ï¸âƒ£ ì´ êµ¬ì¡°ì˜ ë³´ì•ˆ ì¥ì 

* Private EC2:

  * Public IP âŒ
  * ì™¸ë¶€ ì§ì ‘ ì ‘ê·¼ âŒ
* NAT Gateway:

  * Outbound ì „ìš©
  * Inbound ì—°ê²° ì°¨ë‹¨ êµ¬ì¡°

ğŸ‘‰ **ë³´ì•ˆ + í¸ì˜ì„± ë‘˜ ë‹¤ í™•ë³´**

---

## 9ï¸âƒ£ ê³ ê°€ìš©ì„±(HA) í¬ì¸íŠ¸

### í˜„ì¬ ìƒíƒœ

* NAT Gateway 1ê°œ
* AZ 1ê°œ

### ê¶Œì¥ êµ¬ì¡°

* AZë§ˆë‹¤ NAT Gateway 1ê°œì”©
* ê° Private Subnetì€ **ê°™ì€ AZì˜ NAT Gateway ì‚¬ìš©**

ğŸ‘‰ AZ í•˜ë‚˜ ì£½ì–´ë„
ë‹¤ë¥¸ AZëŠ” ì •ìƒ ë™ì‘

---

## ğŸ”Ÿ ì‹¤ìŠµ í•µì‹¬ ìš”ì•½ (ì‹œí—˜ìš©)

### âœ” ë¬¸ì œ ì›ì¸

* NAT Instance ì¤‘ì§€ â†’ Route Table **Black hole**

### âœ” í•´ê²° ë°©ë²•

* NAT Gateway ìƒì„±
* Private Route Table ìˆ˜ì •

### âœ” NAT Gateway íŠ¹ì§•

* Managed Service
* Security Group ì„¤ì • âŒ
* Public Subnet + Elastic IP í•„ìˆ˜

---

## 1ï¸âƒ£1ï¸âƒ£ ìµœì¢… í•œ ë¬¸ì¥ ì •ë¦¬

> **Private Subnetì˜ ì¸í„°ë„· ì—°ê²°ì€
> NAT Gatewayê°€ ê°€ì¥ ì•ˆì •ì ì´ê³  í‘œì¤€ì ì¸ í•´ë‹µì´ë‹¤**


```markdown
# NAT Gateways Hands On  
# NAT ê²Œì´íŠ¸ì›¨ì´ ì‹¤ìŠµ  

ğŸ® ê²Œì„ë³´ìƒ: "Gateway Engineer" +400 XP  

---

## Introduction to NAT Gateway Setup  
## NAT ê²Œì´íŠ¸ì›¨ì´ ì„¤ì • ì†Œê°œ  

When NAT instances are stopped or terminated, internet access is lost.  
NAT ì¸ìŠ¤í„´ìŠ¤ê°€ ì¤‘ì§€ë˜ê±°ë‚˜ ì¢…ë£Œë˜ë©´ ì¸í„°ë„· ì ‘ê·¼ì´ ë¶ˆê°€ëŠ¥í•´ì§‘ë‹ˆë‹¤.  

For example, attempting to use curl to access external sites will fail.  
ì˜ˆë¥¼ ë“¤ì–´, curl ëª…ë ¹ìœ¼ë¡œ ì™¸ë¶€ ì‚¬ì´íŠ¸ì— ì ‘ì†í•˜ë ¤ê³  í•˜ë©´ ì‹¤íŒ¨í•©ë‹ˆë‹¤.  

To resolve this, we will set up a NAT Gateway.  
ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ NAT ê²Œì´íŠ¸ì›¨ì´ë¥¼ ì„¤ì •í•  ê²ƒì…ë‹ˆë‹¤.  

---

## Observing the Private Route Table  
## í”„ë¼ì´ë¹— ë¼ìš°íŠ¸ í…Œì´ë¸” ê´€ì°°  

Refreshing the private route table reveals that the destination targeting the Elastic Network Interface (ENI) is a black hole.  
í”„ë¼ì´ë¹— ë¼ìš°íŠ¸ í…Œì´ë¸”ì„ ìƒˆë¡œ ê³ ì¹¨í•˜ë©´ Elastic Network Interface(ENI)ë¥¼ ëŒ€ìƒìœ¼ë¡œ í•˜ëŠ” ê²½ë¡œê°€ ë¸”ë™í™€ì„ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  

A black hole indicates that the route is inactive because the NAT instance has been stopped, so the route leads nowhere.  
ë¸”ë™í™€ì€ NAT ì¸ìŠ¤í„´ìŠ¤ê°€ ì¤‘ì§€ë˜ì–´ ê²½ë¡œê°€ ë¹„í™œì„±í™”ë˜ì—ˆìŒì„ ì˜ë¯¸í•˜ë©°, íŠ¸ë˜í”½ì´ ì–´ë””ë¡œë„ ì „ë‹¬ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.  

This highlights the advantage of using managed services like NAT Gateways over NAT instances.  
ì´ëŠ” NAT ê²Œì´íŠ¸ì›¨ì´ì™€ ê°™ì€ ê´€ë¦¬í˜• ì„œë¹„ìŠ¤ë¥¼ NAT ì¸ìŠ¤í„´ìŠ¤ ëŒ€ì‹  ì‚¬ìš©í•˜ëŠ” ì¥ì ì„ ë³´ì—¬ì¤ë‹ˆë‹¤.  

---

## Creating a NAT Gateway  
## NAT ê²Œì´íŠ¸ì›¨ì´ ìƒì„±  

We will create a NAT Gateway named DemoNATGW.  
DemoNATGWë¼ëŠ” ì´ë¦„ìœ¼ë¡œ NAT ê²Œì´íŠ¸ì›¨ì´ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.  

When selecting a subnet for the NAT Gateway, it should be in a public subnet.  
NAT ê²Œì´íŠ¸ì›¨ì´ì— ì„œë¸Œë„·ì„ ì„ íƒí•  ë•Œ, í¼ë¸”ë¦­ ì„œë¸Œë„·ì´ì–´ì•¼ í•©ë‹ˆë‹¤.  

For high availability, multiple subnets across availability zones are recommended, but we will start with one: PublicSubnetA.  
ê³ ê°€ìš©ì„±ì„ ìœ„í•´ ì—¬ëŸ¬ ê°€ìš© ì˜ì—­ì˜ ì„œë¸Œë„·ì„ ì¶”ì²œí•˜ì§€ë§Œ, ìš°ì„  í•˜ë‚˜ì˜ í¼ë¸”ë¦­ ì„œë¸Œë„·(PublicSubnetA)ìœ¼ë¡œ ì‹œì‘í•©ë‹ˆë‹¤.  

The connectivity type is set to public.  
ì—°ê²° ìœ í˜•ì€ í¼ë¸”ë¦­ìœ¼ë¡œ ì„¤ì •ë©ë‹ˆë‹¤.  

Next, allocate an Elastic IP address to the NAT Gateway.  
ë‹¤ìŒìœ¼ë¡œ NAT ê²Œì´íŠ¸ì›¨ì´ì— Elastic IP ì£¼ì†Œë¥¼ í• ë‹¹í•©ë‹ˆë‹¤.  

Once the Elastic IP is allocated, proceed to create the NAT Gateway.  
Elastic IPë¥¼ í• ë‹¹í•œ í›„, NAT ê²Œì´íŠ¸ì›¨ì´ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.  

The NAT Gateway creation process begins and may take some time to become active.  
NAT ê²Œì´íŠ¸ì›¨ì´ ìƒì„± ê³¼ì •ì´ ì‹œì‘ë˜ë©°, í™œì„± ìƒíƒœê°€ ë˜ê¸°ê¹Œì§€ ì‹œê°„ì´ ê±¸ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.  

---

## Updating the Private Route Table  
## í”„ë¼ì´ë¹— ë¼ìš°íŠ¸ í…Œì´ë¸” ì—…ë°ì´íŠ¸  

While the NAT Gateway is being created, edit the private route table.  
NAT ê²Œì´íŠ¸ì›¨ì´ê°€ ìƒì„±ë˜ëŠ” ë™ì•ˆ í”„ë¼ì´ë¹— ë¼ìš°íŠ¸ í…Œì´ë¸”ì„ í¸ì§‘í•©ë‹ˆë‹¤.  

Remove the black hole route that previously directed internet traffic to the stopped NAT instance.  
ì´ì „ì— ì¤‘ì§€ëœ NAT ì¸ìŠ¤í„´ìŠ¤ë¡œ ì¸í„°ë„· íŠ¸ë˜í”½ì„ ë³´ë‚´ë˜ ë¸”ë™í™€ ê²½ë¡œë¥¼ ì œê±°í•©ë‹ˆë‹¤.  

Instead, add a route that directs internet-bound traffic to the newly created NAT Gateway DemoNATGW.  
ëŒ€ì‹  ìƒˆë¡œ ìƒì„±í•œ NAT ê²Œì´íŠ¸ì›¨ì´ DemoNATGWë¡œ ì¸í„°ë„· íŠ¸ë˜í”½ì„ ë³´ë‚´ëŠ” ê²½ë¡œë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.  

Save the changes to activate the new route.  
ë³€ê²½ ì‚¬í•­ì„ ì €ì¥í•˜ì—¬ ìƒˆ ê²½ë¡œë¥¼ í™œì„±í™”í•©ë‹ˆë‹¤.  

The NAT Gateway may take a few moments to become active.  
NAT ê²Œì´íŠ¸ì›¨ì´ê°€ í™œì„± ìƒíƒœê°€ ë˜ê¸°ê¹Œì§€ ì ì‹œ ì‹œê°„ì´ ê±¸ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.  

Once its state changes to active, the private subnet instances can send traffic through it to access the internet.  
ìƒíƒœê°€ í™œì„±ìœ¼ë¡œ ë°”ë€Œë©´, í”„ë¼ì´ë¹— ì„œë¸Œë„·ì˜ ì¸ìŠ¤í„´ìŠ¤ê°€ NAT ê²Œì´íŠ¸ì›¨ì´ë¥¼ í†µí•´ ì¸í„°ë„·ì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  

---

## Verifying Internet Connectivity  
## ì¸í„°ë„· ì—°ê²° í™•ì¸  

After the NAT Gateway is active, verify internet connectivity from an instance in the private subnet.  
NAT ê²Œì´íŠ¸ì›¨ì´ê°€ í™œì„±í™”ëœ í›„, í”„ë¼ì´ë¹— ì„œë¸Œë„· ì¸ìŠ¤í„´ìŠ¤ì—ì„œ ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•©ë‹ˆë‹¤.  

For example, running curl google.com or ping google.com should succeed, confirming that the NAT Gateway is functioning correctly.  
ì˜ˆë¥¼ ë“¤ì–´ curl google.comì´ë‚˜ ping google.com ëª…ë ¹ì„ ì‹¤í–‰í•˜ë©´ ì„±ê³µí•˜ë©°, NAT ê²Œì´íŠ¸ì›¨ì´ê°€ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•¨ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  

This setup does not require specifying security group rules for the NAT Gateway or making the instance public.  
ì´ êµ¬ì„±ì—ì„œëŠ” NAT ê²Œì´íŠ¸ì›¨ì´ì— ëŒ€í•œ ë³´ì•ˆ ê·¸ë£¹ ê·œì¹™ì„ ì§€ì •í•˜ê±°ë‚˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ í¼ë¸”ë¦­ìœ¼ë¡œ ë§Œë“¤ í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤.  

This configuration allows instances in private subnets to access the internet for tasks such as updating the operating system using commands like sudo yum update, without exposing the instances publicly.  
ì´ êµ¬ì„±ì€ í”„ë¼ì´ë¹— ì„œë¸Œë„· ì¸ìŠ¤í„´ìŠ¤ê°€ í¼ë¸”ë¦­ ë…¸ì¶œ ì—†ì´ sudo yum updateì™€ ê°™ì€ OS ì—…ë°ì´íŠ¸ ì‘ì—…ì„ ìœ„í•´ ì¸í„°ë„·ì— ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤.  

---

## High Availability Considerations  
## ê³ ê°€ìš©ì„± ê³ ë ¤ì‚¬í•­  

Currently, we have created one NAT Gateway in a single availability zone.  
í˜„ì¬ í•œ ê°€ìš© ì˜ì—­ì— NAT ê²Œì´íŠ¸ì›¨ì´ í•˜ë‚˜ë¥¼ ìƒì„±í–ˆìŠµë‹ˆë‹¤.  

For high availability, it is recommended to create additional NAT Gateways in other availability zones and update the route tables accordingly.  
ê³ ê°€ìš©ì„±ì„ ìœ„í•´ ë‹¤ë¥¸ ê°€ìš© ì˜ì—­ì— ì¶”ê°€ NAT ê²Œì´íŠ¸ì›¨ì´ë¥¼ ìƒì„±í•˜ê³  ë¼ìš°íŠ¸ í…Œì´ë¸”ì„ ì—…ë°ì´íŠ¸í•˜ëŠ” ê²ƒì´ ê¶Œì¥ë©ë‹ˆë‹¤.  

This setup ensures resilience against failures affecting an entire availability zone.  
ì´ êµ¬ì„±ì€ ì „ì²´ ê°€ìš© ì˜ì—­ì— ì˜í–¥ì„ ë¯¸ì¹˜ëŠ” ì¥ì• ì— ëŒ€ë¹„í•œ ë‚´ê²°í•¨ì„±ì„ ë³´ì¥í•©ë‹ˆë‹¤.  

---

## Conclusion  
## ê²°ë¡   

In this lecture, we created a NAT Gateway to replace a stopped NAT instance, updated the private route table to direct traffic through the NAT Gateway, and verified internet connectivity from a private subnet instance.  
ì´ë²ˆ ê°•ì˜ì—ì„œëŠ” ì¤‘ì§€ëœ NAT ì¸ìŠ¤í„´ìŠ¤ë¥¼ ëŒ€ì²´í•  NAT ê²Œì´íŠ¸ì›¨ì´ë¥¼ ìƒì„±í•˜ê³ , í”„ë¼ì´ë¹— ë¼ìš°íŠ¸ í…Œì´ë¸”ì„ ì—…ë°ì´íŠ¸í•˜ì—¬ íŠ¸ë˜í”½ì´ NAT ê²Œì´íŠ¸ì›¨ì´ë¥¼ í†µí•´ ì „ë‹¬ë˜ë„ë¡ ì„¤ì •í•˜ë©°, í”„ë¼ì´ë¹— ì„œë¸Œë„· ì¸ìŠ¤í„´ìŠ¤ì—ì„œ ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í–ˆìŠµë‹ˆë‹¤.  

This approach improves reliability and security by using managed services and avoiding public exposure of instances.  
ì´ ì ‘ê·¼ ë°©ì‹ì€ ê´€ë¦¬í˜• ì„œë¹„ìŠ¤ë¥¼ ì‚¬ìš©í•˜ê³  ì¸ìŠ¤í„´ìŠ¤ë¥¼ í¼ë¸”ë¦­ì— ë…¸ì¶œí•˜ì§€ ì•ŠìŒìœ¼ë¡œì¨ ì‹ ë¢°ì„±ê³¼ ë³´ì•ˆì„ í–¥ìƒì‹œí‚µë‹ˆë‹¤.  

---

## Key Takeaways  
## í•µì‹¬ ìš”ì•½  

- NAT instances can become black holes when stopped, causing loss of internet access.  
- NAT ì¸ìŠ¤í„´ìŠ¤ëŠ” ì¤‘ì§€ë  ê²½ìš° ë¸”ë™í™€ì´ ë˜ì–´ ì¸í„°ë„· ì ‘ê·¼ì´ ë¶ˆê°€ëŠ¥í•´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.  

- NAT Gateways provide a managed, highly available solution for internet access from private subnets.  
- NAT ê²Œì´íŠ¸ì›¨ì´ëŠ” í”„ë¼ì´ë¹— ì„œë¸Œë„·ì˜ ì¸í„°ë„· ì ‘ê·¼ì„ ìœ„í•´ ê´€ë¦¬í˜•, ê³ ê°€ìš©ì„± ì†”ë£¨ì…˜ì„ ì œê³µí•©ë‹ˆë‹¤.  

- Creating a NAT Gateway involves selecting a public subnet and allocating an Elastic IP.  
- NAT ê²Œì´íŠ¸ì›¨ì´ë¥¼ ìƒì„±í•˜ë ¤ë©´ í¼ë¸”ë¦­ ì„œë¸Œë„·ì„ ì„ íƒí•˜ê³  Elastic IPë¥¼ í• ë‹¹í•´ì•¼ í•©ë‹ˆë‹¤.  

- Updating the private route table to direct internet traffic to the NAT Gateway restores connectivity without exposing instances publicly.  
- í”„ë¼ì´ë¹— ë¼ìš°íŠ¸ í…Œì´ë¸”ì„ ì—…ë°ì´íŠ¸í•˜ì—¬ ì¸í„°ë„· íŠ¸ë˜í”½ì„ NAT ê²Œì´íŠ¸ì›¨ì´ë¡œ ì „ë‹¬í•˜ë©´, ì¸ìŠ¤í„´ìŠ¤ë¥¼ í¼ë¸”ë¦­ì— ë…¸ì¶œí•˜ì§€ ì•Šê³ ë„ ì—°ê²°ì„±ì„ ë³µì›í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
```

