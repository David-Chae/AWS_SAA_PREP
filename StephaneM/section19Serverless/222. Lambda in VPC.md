# **Lambda in VPC â€“ ì‰½ê²Œ ì´í•´í•˜ê¸°**

## 1ï¸âƒ£ ê¸°ë³¸ Lambda ë„¤íŠ¸ì›Œí‚¹

* **ê¸°ë³¸ ë™ì‘:** LambdaëŠ” ê¸°ë³¸ì ìœ¼ë¡œ **AWS ì†Œìœ  VPC**ì—ì„œ ì‹¤í–‰ë¨ â†’ ì‚¬ìš©ìì˜ VPCì— ì†í•˜ì§€ ì•ŠìŒ.
* **ê²°ê³¼:** LambdaëŠ” **VPC ë‚´ë¶€ì˜ ì‚¬ì„¤ ë¦¬ì†ŒìŠ¤(ì˜ˆ: RDS, ElastiCache, ë‚´ë¶€ LB)**ì— ì ‘ê·¼í•  ìˆ˜ ì—†ìŒ.
* **ëŒ€ì‹  ì ‘ê·¼ ê°€ëŠ¥í•œ ê²ƒ:** ì¸í„°ë„·ì— ê³µê°œëœ API, DynamoDB ê°™ì€ í¼ë¸”ë¦­ AWS ì„œë¹„ìŠ¤.

ì¦‰, í¼ë¸”ë¦­ ë¦¬ì†ŒìŠ¤ëŠ” ë¬¸ì œì—†ì§€ë§Œ, ì‚¬ì„¤ ë¦¬ì†ŒìŠ¤ë¥¼ ì“°ë ¤ë©´ **Lambdaë¥¼ ë‚´ VPC ì•ˆì—ì„œ ì‹¤í–‰**í•´ì•¼ í•¨.

---

## 2ï¸âƒ£ Lambdaë¥¼ VPCì— ì—°ê²°í•˜ëŠ” ë°©ë²•

* Lambda ìƒì„± ì‹œ:

  * **VPC ID** ì§€ì •
  * **ì„œë¸Œë„·** ì„ íƒ (Lambdaê°€ ì–´ë””ì„œ ì‹¤í–‰ë ì§€)
  * **ë³´ì•ˆ ê·¸ë£¹** ì—°ê²° (ì ‘ê·¼ ê¶Œí•œ ì •ì˜)
* ì´ ê³¼ì •ì„ ê±°ì¹˜ë©´ Lambdaì— **Elastic Network Interface(ENI)**ê°€ ë§Œë“¤ì–´ì§€ê³ , VPC ë‚´ë¶€ ë¦¬ì†ŒìŠ¤ì— ì ‘ê·¼ ê°€ëŠ¥í•´ì§.
* ì¥ì : ì‚¬ì„¤ ë¦¬ì†ŒìŠ¤ì— **ì•ˆì „í•˜ê²Œ ì ‘ê·¼ ê°€ëŠ¥**.

---

## 3ï¸âƒ£ Lambda + RDS Proxy í™œìš©

* ë¬¸ì œ: Lambdaê°€ RDSì— ì§ì ‘ ì—°ê²°ë  ë•Œ

  * ë§ì€ Lambda ì¸ìŠ¤í„´ìŠ¤ê°€ ê°‘ìê¸° ìƒê¸°ê±°ë‚˜ ì—†ì–´ì§€ë©´
  * **DBì— ì—°ê²°ì´ í­ì£¼** â†’ íƒ€ì„ì•„ì›ƒ, ì¥ì•  ë°œìƒ ê°€ëŠ¥
* í•´ê²°ì±…: **RDS Proxy ì‚¬ìš©**

  * Lambda â†’ RDS Proxy â†’ RDS
  * Proxyê°€ ì—°ê²°ì„ í’€(pool)ë§ â†’ DB ë¶€í•˜ ê°ì†Œ
  * Failover ì‹œì—ë„ ì—°ê²° ìœ ì§€ â†’ ê°€ìš©ì„± í–¥ìƒ
  * IAM ì¸ì¦ ì ìš© ê°€ëŠ¥ â†’ ë³´ì•ˆ ê°•í™”

**ì¡°ê±´:** LambdaëŠ” VPC ì•ˆì—ì„œ ì‹¤í–‰ë˜ì–´ì•¼ RDS Proxyì™€ ì—°ê²° ê°€ëŠ¥
â†’ ProxyëŠ” **ì ˆëŒ€ í¼ë¸”ë¦­ ì ‘ê·¼ ë¶ˆê°€**ì„

---

## 4ï¸âƒ£ í•µì‹¬ ìš”ì•½

1. ê¸°ë³¸ LambdaëŠ” **VPC ë°–**ì—ì„œ ì‹¤í–‰ â†’ ì‚¬ì„¤ ë¦¬ì†ŒìŠ¤ ì ‘ê·¼ ë¶ˆê°€
2. ì‚¬ì„¤ ë¦¬ì†ŒìŠ¤(RDS, ElastiCache ë“±) ì ‘ê·¼í•˜ë ¤ë©´ **Lambdaë¥¼ VPCì— ë°°ì¹˜**
3. RDS Proxyë¥¼ ì‚¬ìš©í•˜ë©´:

   * DB ì—°ê²° í­ì£¼ ë°©ì§€
   * ê°€ìš©ì„± í–¥ìƒ
   * IAM ì¸ì¦ ê°€ëŠ¥
4. Lambdaì™€ RDS ProxyëŠ” **ê°™ì€ VPC ì•ˆì— ìˆì–´ì•¼ í•¨**

---

# Lambda in VPC

**VPC ë‚´ì˜ Lambda**

---

## Introduction to Lambda Networking Fundamentals

**Lambda ë„¤íŠ¸ì›Œí‚¹ ê¸°ì´ˆ ì†Œê°œ**
ğŸ‘‰ AWS Lambda í•¨ìˆ˜ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ì‚¬ìš©ìì˜ VPCê°€ ì•„ë‹Œ AWSê°€ ê´€ë¦¬í•˜ëŠ” VPCì—ì„œ ì‹¤í–‰ëœë‹¤. ë”°ë¼ì„œ ê¸°ë³¸ ì„¤ì •ë§Œìœ¼ë¡œëŠ” ì‚¬ìš©ìì˜ VPC ë‚´ë¶€ ë¦¬ì†ŒìŠ¤ì— ì ‘ê·¼í•  ìˆ˜ ì—†ë‹¤.

---

By default, when you launch your AWS Lambda functions, they are launched outside of your own Virtual Private Cloud (VPC). Instead, they run within an AWS-owned VPC. Consequently, these Lambda functions do not have access to resources inside your VPC.
ê¸°ë³¸ì ìœ¼ë¡œ AWS Lambda í•¨ìˆ˜ëŠ” ì‚¬ìš©ìì˜ VPC ì™¸ë¶€, ì¦‰ AWSê°€ ì†Œìœ í•œ VPCì—ì„œ ì‹¤í–‰ëœë‹¤. ë”°ë¼ì„œ Lambda í•¨ìˆ˜ëŠ” ì‚¬ìš©ìì˜ VPC ë‚´ë¶€ ë¦¬ì†ŒìŠ¤ì— ì ‘ê·¼í•  ìˆ˜ ì—†ë‹¤.
ğŸ‘‰ ê¸°ë³¸ LambdaëŠ” ì¸í„°ë„· ë¦¬ì†ŒìŠ¤ ì ‘ê·¼ì—ëŠ” ë¬¸ì œê°€ ì—†ì§€ë§Œ, VPC ë‚´ë¶€ DB ë“±ì—ëŠ” ì ‘ê·¼í•  ìˆ˜ ì—†ë‹¤.

---

For example, if you launch an Amazon RDS database, an ElastiCache cache, or an internal load balancer within your VPC, your Lambda function will not be able to access these resources by default.
ì˜ˆë¥¼ ë“¤ì–´, VPC ë‚´ë¶€ì— Amazon RDS ë°ì´í„°ë² ì´ìŠ¤, ElastiCache, ë‚´ë¶€ ë¡œë“œë°¸ëŸ°ì„œë¥¼ ìƒì„±í•´ë„ LambdaëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ì ‘ê·¼í•  ìˆ˜ ì—†ë‹¤.
ğŸ‘‰ VPC ë¦¬ì†ŒìŠ¤ ì ‘ê·¼ì—ëŠ” ë„¤íŠ¸ì›Œí¬ êµ¬ì„±ì´ í•„ìš”í•˜ë‹¤.

---

This default Lambda deployment works well if your function needs to access any public API on the internet or services like DynamoDB, which is a public resource on AWS Cloud.
ì´ ê¸°ë³¸ ë°°í¬ëŠ” ì¸í„°ë„·ì˜ í¼ë¸”ë¦­ APIë‚˜ DynamoDB ê°™ì€ AWS í¼ë¸”ë¦­ ë¦¬ì†ŒìŠ¤ì— ì ‘ê·¼í•  ë•ŒëŠ” ì˜ ì‘ë™í•œë‹¤.
ğŸ‘‰ í¼ë¸”ë¦­ ì„œë¹„ìŠ¤ì™€ í†µì‹ í•  ë•ŒëŠ” ê¸°ë³¸ Lambdaë§Œìœ¼ë¡œ ì¶©ë¶„í•˜ë‹¤.

---

However, if you have a private RDS database, the connectivity will not work unless you take additional steps. Therefore, you need to launch your Lambda function inside your VPC to enable access to private resources.
í•˜ì§€ë§Œ í”„ë¼ì´ë¹— RDS ê°™ì€ ë¦¬ì†ŒìŠ¤ëŠ” ê¸°ë³¸ Lambdaë¡œ ì ‘ê·¼ì´ ë¶ˆê°€ëŠ¥í•˜ë¯€ë¡œ, Lambdaë¥¼ VPC ë‚´ë¶€ì—ì„œ ì‹¤í–‰í•´ì•¼ í•œë‹¤.
ğŸ‘‰ í”„ë¼ì´ë¹— ë¦¬ì†ŒìŠ¤ ì ‘ê·¼ â†’ Lambdaë¥¼ VPCì— ë°°ì¹˜ í•„ìš”.

---

To launch a Lambda function in your VPC, you must specify your VPC ID, the subnets where you want the function to run, and attach a security group to your Lambda function.
VPC ë‚´ë¶€ì—ì„œ Lambdaë¥¼ ì‹¤í–‰í•˜ë ¤ë©´ VPC ID, ì‹¤í–‰í•  ì„œë¸Œë„·, ê·¸ë¦¬ê³  Lambdaì— ë³´ì•ˆ ê·¸ë£¹ì„ ì§€ì •í•´ì•¼ í•œë‹¤.
ğŸ‘‰ VPC ë°°ì¹˜ ì‹œ ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ê°€ ìƒì„±ë˜ì–´ VPC ìì› ì ‘ê·¼ì´ ê°€ëŠ¥í•´ì§„ë‹¤.

---

This setup creates an elastic network interface in your specified subnets, enabling your Lambda function to access resources such as Amazon RDS running within your VPC.
ì´ ì„¤ì •ì€ ì§€ì •ëœ ì„œë¸Œë„·ì— ENI(Elastic Network Interface)ë¥¼ ìƒì„±í•´, Lambdaê°€ VPC ë‚´ë¶€ì˜ RDS ê°™ì€ ë¦¬ì†ŒìŠ¤ì— ì ‘ê·¼í•  ìˆ˜ ìˆê²Œ í•œë‹¤.
ğŸ‘‰ í•µì‹¬: ENI ìƒì„±ì´ VPC ì ‘ê·¼ ì—´ì‡ .

---

This approach allows your Lambda function to have private connectivity to anything within your VPC, which is highly beneficial for accessing private resources securely.
ì´ ë°©ì‹ìœ¼ë¡œ LambdaëŠ” VPC ë‚´ë¶€ì˜ í”„ë¼ì´ë¹— ë¦¬ì†ŒìŠ¤ì— ì•ˆì „í•˜ê²Œ ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤.
ğŸ‘‰ ë³´ì•ˆì„±ê³¼ í™•ì¥ì„± í™•ë³´ ê°€ëŠ¥.

---

## Using Lambda with RDS Proxy

**Lambdaì™€ RDS Proxy ì‚¬ìš©**

---

A major use case of running Lambda functions inside a VPC is to use them with an RDS proxy.
Lambdaë¥¼ VPC ë‚´ë¶€ì—ì„œ ì‹¤í–‰í•˜ëŠ” ì£¼ìš” ì‚¬ë¡€ ì¤‘ í•˜ë‚˜ëŠ” RDS Proxyì™€ í•¨ê»˜ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ë‹¤.
ğŸ‘‰ RDS ProxyëŠ” DB ì—°ê²° ê´€ë¦¬ íš¨ìœ¨í™” ë„êµ¬.

---

Consider an RDS database deployed in a private subnet and Lambda functions that access it directly. This direct access can cause significant problems under high load.
í”„ë¼ì´ë¹— ì„œë¸Œë„·ì— ë°°ì¹˜ëœ RDSì— Lambdaê°€ ì§ì ‘ ì ‘ê·¼í•˜ë©´, ë¶€í•˜ê°€ ì»¤ì§ˆ ë•Œ ì‹¬ê°í•œ ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤.
ğŸ‘‰ ë‹¤ìˆ˜ì˜ Lambda ì—°ê²°ì´ DBë¥¼ ì••ë°•í•  ìˆ˜ ìˆë‹¤.

---

If many Lambda functions appear and disappear over time, they may open too many connections to the RDS database. This can overwhelm the database, leading to timeouts and other issues.
Lambda í•¨ìˆ˜ê°€ ëŒ€ëŸ‰ìœ¼ë¡œ ìƒì„±Â·ì†Œë©¸í•˜ë©´, RDSì— ë„ˆë¬´ ë§ì€ ì—°ê²°ì„ ì—´ì–´ DB ê³¼ë¶€í•˜ì™€ íƒ€ì„ì•„ì›ƒì„ ìœ ë°œí•  ìˆ˜ ìˆë‹¤.
ğŸ‘‰ "DB ì—°ê²° í­ë°œ ë¬¸ì œ".

---

To solve this, you can launch an RDS proxy. The proxy manages and pools connections, reducing the number of direct connections to your RDS database instance.
ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ RDS Proxyë¥¼ ë°°ì¹˜í•œë‹¤. ProxyëŠ” ì—°ê²°ì„ ê´€ë¦¬Â·í’€ë§í•˜ì—¬ RDSë¡œì˜ ì§ì ‘ ì—°ê²° ìˆ˜ë¥¼ ì¤„ì¸ë‹¤.
ğŸ‘‰ ì—°ê²° í’€ë§ â†’ DB ë¶€ë‹´ ê°ì†Œ.

---

Lambda functions connect to the RDS proxy, which in turn connects to the database instance, effectively solving architectural problems related to connection management.
LambdaëŠ” RDS Proxyì— ì—°ê²°í•˜ê³ , Proxyê°€ DBì— ì—°ê²°í•œë‹¤. ì´ë ‡ê²Œ í•´ì„œ ì—°ê²° ê´€ë¦¬ ë¬¸ì œë¥¼ í•´ê²°í•œë‹¤.
ğŸ‘‰ ì¤‘ê°„ ê³„ì¸µì„ ë‘¬ì„œ í™•ì¥ì„±ê³¼ ì•ˆì •ì„± í™•ë³´.

---

## Benefits of RDS Proxy

**RDS Proxyì˜ ì¥ì **

* **Improved Scalability:** It pulls and shares database connections efficiently.
  **í™•ì¥ì„± ê°œì„ :** DB ì—°ê²°ì„ íš¨ìœ¨ì ìœ¼ë¡œ í’€ë§Â·ê³µìœ í•œë‹¤.
  ğŸ‘‰ ëŒ€ê·œëª¨ íŠ¸ë˜í”½ ëŒ€ì‘ì— ìœ ë¦¬.

* **Enhanced Availability:** In case of a failover, it reduces failover time by \~66% and preserves connections. Works with RDS & Aurora.
  **ê°€ìš©ì„± í–¥ìƒ:** ì¥ì•  ì¡°ì¹˜ ì‹œ ì‹œê°„ì„ 66% ë‹¨ì¶•í•˜ê³  ì—°ê²°ì„ ìœ ì§€í•œë‹¤. RDSì™€ Auroraì— ì ìš© ê°€ëŠ¥.
  ğŸ‘‰ ë¹ ë¥¸ ì¥ì•  ëŒ€ì‘.

* **IAM Authentication Enforcement:** You can enforce IAM auth at the RDS proxy and securely store credentials in AWS Secrets Manager.
  **IAM ì¸ì¦ ì ìš©:** IAM ì¸ì¦ì„ RDS Proxy ë ˆë²¨ì—ì„œ ê°•ì œí•˜ê³ , Secrets Managerì— ìê²© ì¦ëª…ì„ ì•ˆì „í•˜ê²Œ ì €ì¥ ê°€ëŠ¥.
  ğŸ‘‰ ë³´ì•ˆ ê°•í™”.

---

For Lambda functions to connect to your RDS proxy, they must be launched inside your VPC. This is because the RDS proxy is never publicly accessible.
Lambdaê°€ RDS Proxyì™€ ì—°ê²°í•˜ë ¤ë©´ ë°˜ë“œì‹œ VPC ë‚´ë¶€ì—ì„œ ì‹¤í–‰ë¼ì•¼ í•œë‹¤. RDS ProxyëŠ” í¼ë¸”ë¦­ ì ‘ê·¼ì´ ë¶ˆê°€ëŠ¥í•˜ê¸° ë•Œë¬¸ì´ë‹¤.
ğŸ‘‰ VPC ë‚´ë¶€ ë°°ì¹˜ í•„ìˆ˜.

---

If you launch your Lambda functions publicly, they will have no network connectivity to the RDS proxy.
í¼ë¸”ë¦­ì— Lambdaë¥¼ ì‹¤í–‰í•˜ë©´ RDS Proxyì™€ ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì´ ë˜ì§€ ì•ŠëŠ”ë‹¤.
ğŸ‘‰ ì™¸ë¶€ ì‹¤í–‰ ë¶ˆê°€ â†’ VPC ë‚´ ì‹¤í–‰ í•„ìš”.

---

## Key Takeaways

**í•µì‹¬ ìš”ì•½**

* By default, AWS Lambda functions run outside your own VPC, limiting access to private resources.
  ê¸°ë³¸ì ìœ¼ë¡œ LambdaëŠ” VPC ì™¸ë¶€ì—ì„œ ì‹¤í–‰ë˜ë¯€ë¡œ í”„ë¼ì´ë¹— ë¦¬ì†ŒìŠ¤ ì ‘ê·¼ì´ ì œí•œëœë‹¤.

* To access private resources like RDS databases, Lambda functions must be launched within your VPC with specified subnets and security groups.
  RDS ê°™ì€ í”„ë¼ì´ë¹— ë¦¬ì†ŒìŠ¤ ì ‘ê·¼ì„ ìœ„í•´ LambdaëŠ” VPC ë‚´ë¶€ì—ì„œ ì„œë¸Œë„·Â·ë³´ì•ˆ ê·¸ë£¹ì„ ì§€ì •í•´ ì‹¤í–‰í•´ì•¼ í•œë‹¤.

* Using an RDS proxy between Lambda functions and RDS databases improves scalability, availability, and allows IAM authentication enforcement.
  Lambdaì™€ RDS ì‚¬ì´ì— RDS Proxyë¥¼ ë‘ë©´ í™•ì¥ì„±, ê°€ìš©ì„±, IAM ì¸ì¦ ì ìš©ì´ ê°€ëŠ¥í•˜ë‹¤.

* Lambda functions must reside in the VPC to connect to the RDS proxy, as the proxy is never publicly accessible.
  RDS ProxyëŠ” í¼ë¸”ë¦­ ì ‘ê·¼ì´ ë¶ˆê°€ëŠ¥í•˜ë¯€ë¡œ, LambdaëŠ” ë°˜ë“œì‹œ VPC ë‚´ë¶€ì—ì„œ ì‹¤í–‰ë¼ì•¼ í•œë‹¤.

---

ğŸ‰ **ë ˆë²¨ì—… ë³´ìƒ:** +120 XP íšë“!
ğŸ‘ ë‹¹ì‹ ì€ ì´ì œ **Lambda Networking Master** ì¹­í˜¸ë¥¼ ì–»ì—ˆìŠµë‹ˆë‹¤.
