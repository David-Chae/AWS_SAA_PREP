# ğŸšš Kinesis Data Streams Hands-On ì´ˆê°„ë‹¨ ì´í•´

ì§€ê¸ˆ ë°°ìš°ëŠ” ê²ƒì€
**â€œì‹¤ì‹œê°„ ë°ì´í„° ê³ ì†ë„ë¡œ(Kinesis Stream)ì— ë°ì´í„°ë¥¼ ë„£ê³  ë˜ êº¼ë‚´ì˜¤ëŠ” ì‹¤ìŠµâ€**
ì´ë¼ê³  ë³´ë©´ ë¨.

---

# 1) Kinesis ì„œë¹„ìŠ¤ ë“¤ì–´ê°€ë©´ ë³´ì´ëŠ” 3ê°€ì§€

* **Data Streams** â†’ ì‹¤ì‹œê°„ ë°ì´í„° ë°›ëŠ” í†µë¡œ(ì´ë²ˆì— ì‚¬ìš©í•˜ëŠ” ê²ƒ)
* **Data Firehose** â†’ ìë™ ì €ì¥ íŒŒì´í”„ë¼ì¸
* **Data Analytics** â†’ ìŠ¤íŠ¸ë¦¼ ë°ì´í„° ë¶„ì„

ìš°ë¦° **Data Streamsë§Œ ë‹¤ë£¸.**

---

# 2) ìŠ¤íŠ¸ë¦¼ ë§Œë“¤ê¸°: DemoStream

ìš°ë¦¬ê°€ ë§Œë“  ê³ ì†ë„ë¡œì˜ ì´ë¦„ = **DemoStream**
ê³ ì†ë„ë¡œì˜ â€œí­â€ì„ ê³ ë¥´ëŠ” ê³¼ì • = ìš©ëŸ‰ ì„¤ì •(ì˜¨ë””ë§¨ë“œ vs í”„ë¡œë¹„ì €ë‹)

### ğŸ…° On-demand(ìë™ í™•ì¥)

* ì§ì ‘ ìš©ëŸ‰ ì•ˆ ì •í•´ë„ ë¨
* ì‹¤ì‹œê°„ìœ¼ë¡œ ì•Œì•„ì„œ í™•ì¥
* ì“°ê¸°: ìµœëŒ€ 200MB/s
* ì½ê¸°(EFO): ìµœëŒ€ 400MB/s
* ë‹¨ì : **ë¬´ë£Œ êµ¬ê°„ ì—†ìŒ, ì“°ëŠ” ë§Œí¼ ê³¼ê¸ˆ**

### ğŸ…± Provisioned(ì§ì ‘ shard ê°œìˆ˜ ì„¤ì •)

* Shardë¼ëŠ” ë„ë¡œ ì¡°ê°ì„ **ì§ì ‘ ëª‡ ê°œ ì“¸ì§€ ì •í•¨**
* í•œ shard =

  * ì“°ê¸° 1MB/s
  * ì½ê¸° 2MB/s
* Shard 10ê°œë©´ 10ë°° ì†ë„
* ì´ë²ˆ ì‹¤ìŠµì—ì„œëŠ” **1 shard**ë§Œ ì‚¬ìš©

---

# 3) ìŠ¤íŠ¸ë¦¼ ìƒì„± ì™„ë£Œ â†’ ì´ì œ â€œë°ì´í„° ë„£ê¸°â€ ì‹¤ìŠµ ì‹œì‘

---

# 4) Producer(ë°ì´í„° ë„£ëŠ” ìª½)

ë°ì´í„°ë¥¼ ìŠ¤íŠ¸ë¦¼ì— ë³´ë‚´ëŠ” ë°©ë²• 3ê°€ì§€:

1. **Kinesis Agent** (ì„œë²„ ë¡œê·¸ ìë™ ì „ì†¡)
2. **SDK** (ë‚´ê°€ ì§ì ‘ ì½”ë“œë¡œ PUT í˜¸ì¶œ)
3. **KPL** (ê³ ì„±ëŠ¥ Producer ë¼ì´ë¸ŒëŸ¬ë¦¬)

ì‹¤ìŠµì—ì„œëŠ” **AWS CLIë¡œ ê°„ë‹¨í•˜ê²Œ ë„£ì–´ë´„.**

---

# 5) Consumer(ë°ì´í„° êº¼ë‚´ëŠ” ìª½)

* Kinesis Analytics
* Kinesis Firehose
* Kinesis Client Library(KCL)
* Lambda ë“±

ì‹¤ìŠµì—ì„œëŠ” **CLIë¥¼ ì‚¬ìš©í•œ ë§¤ìš° ê¸°ì´ˆì ì¸ ë°©ì‹ìœ¼ë¡œ ì½ê¸°.**

---

# 6) AWS CloudShell ì‚¬ìš©

CloudShellì€
âœ” IAM ê¶Œí•œ ìë™ ì ìš©
âœ” AWS CLI v2 ìë™ ì„¤ì¹˜
âœ” ì§€ì—­(region) ìë™ ì„¤ì •
â†’ ë°”ë¡œ ëª…ë ¹ì–´ ì‹¤í–‰ ê°€ëŠ¥

---

# 7) CLIë¡œ Streamì— â€œë°ì´í„° ë³´ë‚´ê¸°â€

PUT ìš”ì²­ ì˜ˆì‹œ:

```bash
aws kinesis put-record \
  --stream-name DemoStream \
  --partition-key user1 \
  --data "users signup" \
  --cli-binary-format raw-in-base64-out
```

í•„ìš”í•œ ìš”ì†Œ:

* ìŠ¤íŠ¸ë¦¼ ì´ë¦„: DemoStream
* partition key: user1 (ë°ì´í„° ìˆœì„œ ìœ ì§€ ê¸°ì¤€)
* ë°ì´í„°: "users signup"
* í…ìŠ¤íŠ¸ ë°ì´í„°ë¥¼ ë„£ê¸° ìœ„í•œ ì˜µì…˜: `--cli-binary-format raw-in-base64-out`

ê²°ê³¼ë¡œ:

* shard ID
* sequence number
  ê°€ ë°˜í™˜ë¨ â†’ ì •ìƒ ì²˜ë¦¬ëœ ê²ƒ.

---

# 8) CloudWatchì—ì„œ ëª¨ë‹ˆí„°ë§

ì¡°ê¸ˆ ê¸°ë‹¤ë¦¬ë©´

* PutRecords
* IncomingBytes
  ê°™ì€ ì§€í‘œê°€ ì˜¬ë¼ì˜¤ëŠ” ê±¸ ë³¼ ìˆ˜ ìˆìŒ.

---

# 9) CLIë¡œ Streamì—ì„œ â€œë°ì´í„° ì½ê¸°â€ (Consumer ì—­í• )

### 1ë‹¨ê³„: shard ì •ë³´ ì¡°íšŒ

```bash
aws kinesis describe-stream --stream-name DemoStream
```

ì¶œë ¥ì— shardId-000000000000 ì´ëŸ° ê°’ ë‚˜ì˜´.

---

### 2ë‹¨ê³„: shard iterator ë§Œë“¤ê¸°

iterator = â€œë°ì´í„° ì–´ë””ë¶€í„° ì½ì–´ë¼â€ë¼ëŠ” í¬ì¸í„°.

```bash
aws kinesis get-shard-iterator \
  --stream-name DemoStream \
  --shard-id shardId-000000000000 \
  --shard-iterator-type TRIM_HORIZON
```

TRIM_HORIZON = ìŠ¤íŠ¸ë¦¼ ì²˜ìŒë¶€í„° ëª¨ë‘ ì½ê¸°
LATEST = ì§€ê¸ˆ ì´í›„ë¶€í„° ì½ê¸°

---

### 3ë‹¨ê³„: iteratorë¡œ record ì½ê¸°

```bash
aws kinesis get-records --shard-iterator <ShardIterator>
```

ì—¬ê¸°ì„œ ë‚˜ì˜¤ëŠ” ë°ì´í„°ëŠ”
`base64` ì¸ì½”ë”© ë˜ì–´ ìˆìŒ â†’ ë””ì½”ë”©í•˜ë©´ ì‹¤ì œ ë©”ì‹œì§€ê°€ ë³´ì„.

ì˜ˆ:

* â€œusers signupâ€
* â€œusers loginâ€
* â€œusers logoutâ€

---

### 4ë‹¨ê³„: ê³„ì† ì½ê³  ì‹¶ìœ¼ë©´?

ì¶œë ¥ì— `NextShardIterator`ë¼ëŠ” ê°’ì´ ìˆëŠ”ë°
ê·¸ê±¸ ë„£ê³  ë‹¤ì‹œ get-records í•˜ë©´ ì´ì–´ì„œ ì½ìŒ.

(ì½”ë“œë¡œ ì§¤ ë•ŒëŠ” ì´ê±¸ ë£¨í”„ ëŒë¦¼)

---

# ğŸ“ í•µì‹¬ ìš”ì•½

* DemoStream(1 shard) ìƒì„±
* ì˜¨ë””ë§¨ë“œ vs í”„ë¡œë¹„ì €ë‹ ì°¨ì´ ì´í•´
* CloudShell â†’ CLIë¡œ ì‹¤ì‹œê°„ ë°ì´í„° PUT
* describe-stream â†’ shard ì •ë³´ í™•ì¸
* get-shard-iterator â†’ ì‹œì‘ í¬ì¸í„° ìƒì„±
* get-records â†’ ë°ì´í„° ì½ê¸°
* base64 ë””ì½”ë”©í•˜ë©´ ì‹¤ì œ ë©”ì‹œì§€ í™•ì¸ ê°€ëŠ¥
* NextShardIteratorë¡œ ì´ì–´ì„œ ì½ê¸° ê°€ëŠ¥

---


# Amazon Kinesis Data Streams - Hands On  
# ì•„ë§ˆì¡´ í‚¤ë„¤ì‹œìŠ¤ ë°ì´í„° ìŠ¤íŠ¸ë¦¼ - ì‹¤ìŠµ  

---

## Introduction to Kinesis Data Streams Hands-On  
## í‚¤ë„¤ì‹œìŠ¤ ë°ì´í„° ìŠ¤íŠ¸ë¦¼ ì‹¤ìŠµ ì†Œê°œ  

Let's begin by practicing with Kinesis Data Streams.  
í‚¤ë„¤ì‹œìŠ¤ ë°ì´í„° ìŠ¤íŠ¸ë¦¼ ì‹¤ìŠµì„ ì‹œì‘í•´ë³´ê² ìŠµë‹ˆë‹¤.  

We will open the Kinesis service and create our first Kinesis Data Stream.  
Kinesis ì„œë¹„ìŠ¤ë¥¼ ì—´ê³  ì²« ë²ˆì§¸ Kinesis ë°ì´í„° ìŠ¤íŠ¸ë¦¼ì„ ìƒì„±í•©ë‹ˆë‹¤.  

Upon opening the Kinesis service, we see three options: Data Streams, Data Firehose, and Data Analytics.  
Kinesis ì„œë¹„ìŠ¤ë¥¼ ì—´ë©´ ì„¸ ê°€ì§€ ì˜µì…˜ì´ ë³´ì…ë‹ˆë‹¤: ë°ì´í„° ìŠ¤íŠ¸ë¦¼, ë°ì´í„° íŒŒì´ì–´í˜¸ìŠ¤, ë°ì´í„° ë¶„ì„.  

So far, we are familiar only with Data Streams, so we will proceed with that.  
ì§€ê¸ˆê¹Œì§€ëŠ” ë°ì´í„° ìŠ¤íŠ¸ë¦¼ë§Œ ìµìˆ™í•˜ë¯€ë¡œ, ì´ë¥¼ ì„ íƒí•˜ì—¬ ì§„í–‰í•©ë‹ˆë‹¤.  

We also see pricing information: for each shard, the cost is $0.05 per hour, plus additional charges for PUT requests or data sent into Kinesis Data Streams.  
ë˜í•œ ê°€ê²© ì •ë³´ë„ ë³´ì´ëŠ”ë°, ìƒ¤ë“œë‹¹ ì‹œê°„ë‹¹ $0.05ì´ë©°, PUT ìš”ì²­ì´ë‚˜ ë°ì´í„° ì „ì†¡ì— ëŒ€í•œ ì¶”ê°€ ìš”ê¸ˆì´ ìˆìŠµë‹ˆë‹¤.  

---

## Creating a Data Stream  
## ë°ì´í„° ìŠ¤íŠ¸ë¦¼ ìƒì„±  

We will create a Data Stream and name it DemoStream.  
ë°ì´í„° ìŠ¤íŠ¸ë¦¼ì„ ìƒì„±í•˜ê³  ì´ë¦„ì„ DemoStreamìœ¼ë¡œ ì§€ì •í•©ë‹ˆë‹¤.  

Next, we define the data stream capacity. There are two modes:  
ë‹¤ìŒìœ¼ë¡œ ë°ì´í„° ìŠ¤íŠ¸ë¦¼ ìš©ëŸ‰ì„ ì •ì˜í•©ë‹ˆë‹¤. ë‘ ê°€ì§€ ëª¨ë“œê°€ ìˆìŠµë‹ˆë‹¤:  

- On-demand mode  
- ì˜¨ë””ë§¨ë“œ ëª¨ë“œ  

- Provisioned mode  
- í”„ë¡œë¹„ì €ë‹ ëª¨ë“œ  

---

### On-demand Mode  
### ì˜¨ë””ë§¨ë“œ ëª¨ë“œ  

In On-demand mode, you do not need to manage capacity as it automatically scales.  
ì˜¨ë””ë§¨ë“œ ëª¨ë“œì—ì„œëŠ” ìš©ëŸ‰ì„ ê´€ë¦¬í•  í•„ìš”ê°€ ì—†ìœ¼ë©° ìë™ìœ¼ë¡œ í™•ì¥ë©ë‹ˆë‹¤.  

The maximum throughput is 200 megabytes per second and 200,000 records per second for writes, and a maximum read capacity of 400 megabytes per second per consumer if using the enhanced Fan-Out option.  
ìµœëŒ€ ì²˜ë¦¬ëŸ‰ì€ ì“°ê¸° ì‹œ ì´ˆë‹¹ 200MB ë° ì´ˆë‹¹ 200,000 ë ˆì½”ë“œì´ë©°, í–¥ìƒëœ Fan-Out ì˜µì…˜ ì‚¬ìš© ì‹œ ì†Œë¹„ìë‹¹ ìµœëŒ€ ì½ê¸° ìš©ëŸ‰ì€ ì´ˆë‹¹ 400MBì…ë‹ˆë‹¤.  

Pricing is pay-per-throughput, but there is no free tier.  
ìš”ê¸ˆì€ ì²˜ë¦¬ëŸ‰ ê¸°ì¤€ìœ¼ë¡œ ë¶€ê³¼ë˜ë©°, ë¬´ë£Œ ìš”ê¸ˆì œëŠ” ì—†ìŠµë‹ˆë‹¤.  

---

### Provisioned Mode  
### í”„ë¡œë¹„ì €ë‹ ëª¨ë“œ  

Provisioned mode requires you to provision shards manually.  
í”„ë¡œë¹„ì €ë‹ ëª¨ë“œì—ì„œëŠ” ìƒ¤ë“œë¥¼ ìˆ˜ë™ìœ¼ë¡œ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤.  

There is a Shard Estimator tool to help determine how many shards you need based on records per second, record size, and number of consumers.  
ìƒ¤ë“œ ì¶”ì • ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ë©´ ì´ˆë‹¹ ë ˆì½”ë“œ ìˆ˜, ë ˆì½”ë“œ í¬ê¸°, ì†Œë¹„ì ìˆ˜ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•„ìš”í•œ ìƒ¤ë“œ ìˆ˜ë¥¼ ê³„ì‚°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  

For this demo, we will set up one shard.  
ì´ë²ˆ ì‹¤ìŠµì—ì„œëŠ” ìƒ¤ë“œ 1ê°œë¡œ ì„¤ì •í•©ë‹ˆë‹¤.  

One shard provides 1 megabyte per second for writes and 2 megabytes per second for reads.  
ìƒ¤ë“œ 1ê°œëŠ” ì“°ê¸° ì´ˆë‹¹ 1MB, ì½ê¸° ì´ˆë‹¹ 2MBì˜ ìš©ëŸ‰ì„ ì œê³µí•©ë‹ˆë‹¤.  

If you provision 10 shards, the capacity multiplies by 10.  
ìƒ¤ë“œ 10ê°œë¥¼ ì„¤ì •í•˜ë©´ ìš©ëŸ‰ì´ 10ë°° ì¦ê°€í•©ë‹ˆë‹¤.  

One shard is sufficient for this demo and is the cheapest option.  
ìƒ¤ë“œ 1ê°œë©´ ì¶©ë¶„í•˜ë©°, ë¹„ìš©ì´ ê°€ì¥ ì €ë ´í•©ë‹ˆë‹¤.  

Note that if you do not want to incur any charges during this course, avoid this hands-on exercise, as you will be charged for the shard, although we will delete it promptly after use.  
ì‹¤ìŠµ ì¤‘ ìš”ê¸ˆ ë°œìƒì„ ì›í•˜ì§€ ì•Šìœ¼ë©´ ì´ ì‹¤ìŠµì„ í”¼í•˜ì„¸ìš”. ì‚¬ìš© í›„ ì¦‰ì‹œ ì‚­ì œí•˜ë”ë¼ë„ ìƒ¤ë“œ ìš”ê¸ˆì´ ë¶€ê³¼ë©ë‹ˆë‹¤.  

When ready, click Create data stream and wait for the stream to be created.  
ì¤€ë¹„ê°€ ë˜ë©´ 'Create data stream'ë¥¼ í´ë¦­í•˜ê³  ìŠ¤íŠ¸ë¦¼ ìƒì„± ì™„ë£Œë¥¼ ê¸°ë‹¤ë¦½ë‹ˆë‹¤.  

Our stream has been successfully created.  
ìŠ¤íŠ¸ë¦¼ì´ ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.  

---

## Producers and Consumers  
## í”„ë¡œë“€ì„œì™€ ì»¨ìŠˆë¨¸  

For applications, producers have three recommended options:  
ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ í”„ë¡œë“€ì„œëŠ” ì„¸ ê°€ì§€ ê¶Œì¥ ì˜µì…˜ì´ ìˆìŠµë‹ˆë‹¤:  

- Kinesis Agents  
- í‚¤ë„¤ì‹œìŠ¤ ì—ì´ì „íŠ¸  

- SDK  
- SDK  

- Kinesis Producer Library (KPL)  
- í‚¤ë„¤ì‹œìŠ¤ í”„ë¡œë“€ì„œ ë¼ì´ë¸ŒëŸ¬ë¦¬(KPL)  

All are available on GitHub.  
ëª¨ë“  ì˜µì…˜ì€ GitHubì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  

The SDK allows low-level producer development, while the KPL offers a higher-level API.  
SDKëŠ” ì €ìˆ˜ì¤€ í”„ë¡œë“€ì„œ ê°œë°œì„ ì§€ì›í•˜ë©°, KPLì€ ê³ ìˆ˜ì¤€ APIë¥¼ ì œê³µí•©ë‹ˆë‹¤.  

Consumers include Kinesis Data Analytics, Kinesis Data Firehose, Kinesis Client Library, and Lambda (not shown in the console options).  
ì»¨ìŠˆë¨¸ì—ëŠ” Kinesis Data Analytics, Kinesis Data Firehose, Kinesis Client Library, Lambdaê°€ í¬í•¨ë©ë‹ˆë‹¤(ì½˜ì†” ì˜µì…˜ì—ëŠ” í‘œì‹œë˜ì§€ ì•ŠìŒ).  

You can monitor your Kinesis Data Streams to see how many records are being sent.  
í‚¤ë„¤ì‹œìŠ¤ ë°ì´í„° ìŠ¤íŠ¸ë¦¼ì—ì„œ ì „ì†¡ë˜ëŠ” ë ˆì½”ë“œ ìˆ˜ë¥¼ ëª¨ë‹ˆí„°ë§í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  

You can also scale the stream by adjusting the number of shards, add tags, and configure enhanced Fan-Out for consumer applications.  
ìƒ¤ë“œ ìˆ˜ ì¡°ì •, íƒœê·¸ ì¶”ê°€, ì»¨ìŠˆë¨¸ìš© í–¥ìƒëœ Fan-Out êµ¬ì„±ìœ¼ë¡œ ìŠ¤íŠ¸ë¦¼ í™•ì¥ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.  

For now, we will keep it simple and use the SDK for producing and consuming data.  
ìš°ì„  SDKë¥¼ ì‚¬ìš©í•´ ë°ì´í„°ë¥¼ ìƒì„±í•˜ê³  ì†Œë¹„í•˜ëŠ” ë‹¨ìˆœí•œ ë°©ë²•ìœ¼ë¡œ ì§„í–‰í•©ë‹ˆë‹¤.  

---

## Using AWS CLI in CloudShell  
## CloudShellì—ì„œ AWS CLI ì‚¬ìš©  

We will open a CLI environment using AWS CloudShell, which provides a preconfigured command line interface in AWS.  
AWS CloudShellì„ ì—´ì–´ CLI í™˜ê²½ì„ ì‚¬ìš©í•©ë‹ˆë‹¤. CloudShellì€ ì‚¬ì „ êµ¬ì„±ëœ AWS CLI í™˜ê²½ì„ ì œê³µí•©ë‹ˆë‹¤.  

This avoids local configuration and is free to use.  
ë¡œì»¬ í™˜ê²½ ì„¤ì •ì´ í•„ìš” ì—†ê³  ë¬´ë£Œë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  

Alternatively, you could use your own terminal or CLI if preconfigured.  
ì‚¬ì „ êµ¬ì„±ëœ ê²½ìš° ë¡œì»¬ í„°ë¯¸ë„ì´ë‚˜ CLIë¥¼ ì‚¬ìš©í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.  

---

## AWS CLI Versions  
## AWS CLI ë²„ì „  

There are two types of commands to write to Kinesis Data Stream depending on your AWS CLI version: version 1 or version 2.  
AWS CLI ë²„ì „ì— ë”°ë¼ Kinesis ë°ì´í„° ìŠ¤íŠ¸ë¦¼ì— ë°ì´í„°ë¥¼ ì“°ëŠ” ëª…ë ¹ì–´ê°€ ë‘ ê°€ì§€ ìœ í˜•ì´ ìˆìŠµë‹ˆë‹¤: ë²„ì „ 1 ë˜ëŠ” ë²„ì „ 2.  

You can check your version by running:  
ë²„ì „ì„ í™•ì¸í•˜ë ¤ë©´ ë‹¤ìŒì„ ì‹¤í–‰í•©ë‹ˆë‹¤:  

```bash
aws --version
````

In CloudShell, AWS CLI version 2 is installed by default.
CloudShellì—ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ AWS CLI ë²„ì „ 2ê°€ ì„¤ì¹˜ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

We will use version 2 commands for this demo.
ì´ë²ˆ ì‹¤ìŠµì—ì„œëŠ” ë²„ì „ 2 ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.

---

## Sending a Record to Kinesis Data Stream

## Kinesis ë°ì´í„° ìŠ¤íŠ¸ë¦¼ì— ë ˆì½”ë“œ ì „ì†¡

To send a record, use the put-record API.
ë ˆì½”ë“œë¥¼ ì „ì†¡í•˜ë ¤ë©´ put-record APIë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.

You need to specify:
ë‹¤ìŒ ì •ë³´ë¥¼ ì§€ì •í•´ì•¼ í•©ë‹ˆë‹¤:

* The stream name (in this case, DemoStream)

* ìŠ¤íŠ¸ë¦¼ ì´ë¦„(ì´ë²ˆ ê²½ìš° DemoStream)

* A partition key (e.g., user1)

* íŒŒí‹°ì…˜ í‚¤(ì˜ˆ: user1)

* The data payload (e.g., users signup)

* ë°ì´í„° í˜ì´ë¡œë“œ(ì˜ˆ: users signup)

* The option --cli-binary-format raw-in-base64-out because we are sending text data

* í…ìŠ¤íŠ¸ ë°ì´í„°ë¥¼ ì „ì†¡í•˜ë¯€ë¡œ --cli-binary-format raw-in-base64-out ì˜µì…˜ ì‚¬ìš©

Example command:
ëª…ë ¹ì–´ ì˜ˆì‹œ:

```bash
aws kinesis put-record --stream-name DemoStream --partition-key user1 --data "users signup" --cli-binary-format raw-in-base64-out
```

The CloudShell automatically uses your IAM credentials and default region (e.g., us-east-1).
CloudShellì€ IAM ìê²© ì¦ëª…ê³¼ ê¸°ë³¸ ë¦¬ì „(e.g., us-east-1)ì„ ìë™ìœ¼ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.

After running the command, you will receive a success message with the shard ID and sequence number.
ëª…ë ¹ ì‹¤í–‰ í›„ ìƒ¤ë“œ IDì™€ ì‹œí€€ìŠ¤ ë²ˆí˜¸ê°€ í¬í•¨ëœ ì„±ê³µ ë©”ì‹œì§€ë¥¼ ë°›ìŠµë‹ˆë‹¤.

You can send multiple messages, such as user signup, user login, and user logout to simulate activity in the stream.
ì—¬ëŸ¬ ë©”ì‹œì§€(user signup, user login, user logout)ë¥¼ ë³´ë‚´ ìŠ¤íŠ¸ë¦¼ í™œë™ì„ ì‹œë®¬ë ˆì´ì…˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

## Monitoring Stream Metrics

## ìŠ¤íŠ¸ë¦¼ ë©”íŠ¸ë¦­ ëª¨ë‹ˆí„°ë§

If you wait a bit and check the monitoring tab, you will see metrics such as the number of put records.
ì ì‹œ ê¸°ë‹¤ë¦° í›„ ëª¨ë‹ˆí„°ë§ íƒ­ì„ í™•ì¸í•˜ë©´ put ë ˆì½”ë“œ ìˆ˜ì™€ ê°™ì€ ë©”íŠ¸ë¦­ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

Note that CloudWatch metrics may take some time to update.
CloudWatch ë©”íŠ¸ë¦­ì€ ì—…ë°ì´íŠ¸ë˜ëŠ” ë° ì‹œê°„ì´ ê±¸ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

## Consuming Data from Kinesis Data Stream

## Kinesis ë°ì´í„° ìŠ¤íŠ¸ë¦¼ì—ì„œ ë°ì´í„° ì†Œë¹„

To consume data, first describe the stream to get shard information:
ë°ì´í„°ë¥¼ ì†Œë¹„í•˜ë ¤ë©´ ë¨¼ì € ìŠ¤íŠ¸ë¦¼ì„ ì„¤ëª…í•˜ì—¬ ìƒ¤ë“œ ì •ë³´ë¥¼ í™•ì¸í•©ë‹ˆë‹¤:

```bash
aws kinesis describe-stream --stream-name DemoStream
```

The output includes a StreamDescription with shard IDs, for example, shardId-0000000000000.
ì¶œë ¥ì—ëŠ” ìƒ¤ë“œ ID(shardId-0000000000000 ë“±)ê°€ í¬í•¨ëœ StreamDescriptionì´ ìˆìŠµë‹ˆë‹¤.

You will need this shard ID to read from the stream.
ìŠ¤íŠ¸ë¦¼ì—ì„œ ì½ìœ¼ë ¤ë©´ ì´ ìƒ¤ë“œ IDê°€ í•„ìš”í•©ë‹ˆë‹¤.

When using the CLI or SDK at a low level, you must specify the shard ID.
ì €ìˆ˜ì¤€ CLI ë˜ëŠ” SDK ì‚¬ìš© ì‹œ ìƒ¤ë“œ IDë¥¼ ì§€ì •í•´ì•¼ í•©ë‹ˆë‹¤.

Higher-level libraries like the Kinesis Client Library handle this automatically.
Kinesis Client Library ê°™ì€ ê³ ìˆ˜ì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” ì´ë¥¼ ìë™ìœ¼ë¡œ ì²˜ë¦¬í•©ë‹ˆë‹¤.

---

## Getting a Shard Iterator

## ìƒ¤ë“œ ì´í„°ë ˆì´í„° ê°€ì ¸ì˜¤ê¸°

To read records, obtain a shard iterator with the following command:
ë ˆì½”ë“œë¥¼ ì½ìœ¼ë ¤ë©´ ë‹¤ìŒ ëª…ë ¹ì–´ë¡œ ìƒ¤ë“œ ì´í„°ë ˆì´í„°ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤:

```bash
aws kinesis get-shard-iterator --stream-name DemoStream --shard-id shardId-0000000000000 --shard-iterator-type TRIM_HORIZON
```

The TRIM\_HORIZON shard iterator type


reads from the very beginning of the stream, retrieving all records sent so far.
TRIM\_HORIZON ìƒ¤ë“œ ì´í„°ë ˆì´í„°ëŠ” ìŠ¤íŠ¸ë¦¼ì˜ ì²˜ìŒë¶€í„° ì½ì–´ ì§€ê¸ˆê¹Œì§€ ì „ì†¡ëœ ëª¨ë“  ë ˆì½”ë“œë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.

Alternatively, you can use LATEST to read only new records from the time the command is run.
ë˜ëŠ” LATESTë¥¼ ì‚¬ìš©í•´ ëª…ë ¹ ì‹¤í–‰ ì‹œì  ì´í›„ì˜ ìƒˆ ë ˆì½”ë“œë§Œ ì½ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

This command returns a ShardIterator string, which you use to fetch records.
ì´ ëª…ë ¹ì€ ShardIterator ë¬¸ìì—´ì„ ë°˜í™˜í•˜ë©°, ì´ë¥¼ ì‚¬ìš©í•´ ë ˆì½”ë“œë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.

---

## Retrieving Records

## ë ˆì½”ë“œ ê°€ì ¸ì˜¤ê¸°

Use the get-records command with the shard iterator to retrieve records:
ìƒ¤ë“œ ì´í„°ë ˆì´í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ get-records ëª…ë ¹ìœ¼ë¡œ ë ˆì½”ë“œë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤:

```bash
aws kinesis get-records --shard-iterator <ShardIterator>
```

The response includes a batch of records with partition keys and base64-encoded data, along with timestamps.
ì‘ë‹µì—ëŠ” íŒŒí‹°ì…˜ í‚¤ì™€ base64 ì¸ì½”ë”©ëœ ë°ì´í„°, íƒ€ì„ìŠ¤íƒ¬í”„ê°€ í¬í•¨ëœ ë ˆì½”ë“œ ë°°ì¹˜ê°€ ë°˜í™˜ë©ë‹ˆë‹¤.

To read the data, decode the base64-encoded strings using an online decoder or programmatically.
ë°ì´í„°ë¥¼ ì½ìœ¼ë ¤ë©´ base64 ì¸ì½”ë”© ë¬¸ìì—´ì„ ì˜¨ë¼ì¸ ë””ì½”ë”ë‚˜ í”„ë¡œê·¸ë¨ìœ¼ë¡œ ë””ì½”ë”©í•©ë‹ˆë‹¤.

For example, decoding the data reveals messages like user signup and user login, matching what was sent.
ì˜ˆ: ë””ì½”ë”©í•˜ë©´ user signup, user login ë“± ì „ì†¡ëœ ë©”ì‹œì§€ê°€ í™•ì¸ë©ë‹ˆë‹¤.

The response also includes a NextShardIterator value, which you use in subsequent get-records calls to continue reading from where you left off.
ì‘ë‹µì—ëŠ” NextShardIterator ê°’ë„ í¬í•¨ë˜ì–´ ìˆìœ¼ë©°, ì´í›„ get-records í˜¸ì¶œ ì‹œ ì´ ê°’ì„ ì‚¬ìš©í•´ ì´ì–´ì„œ ì½ìŠµë‹ˆë‹¤.

This iteration must be managed in your code.
ì´í„°ë ˆì´ì…˜ ê´€ë¦¬ëŠ” ì½”ë“œì—ì„œ ì§ì ‘ ì²˜ë¦¬í•´ì•¼ í•©ë‹ˆë‹¤.

---

## Summary

## ìš”ì•½

We have successfully produced data to and consumed data from a Kinesis Data Stream using AWS CLI in CloudShell.
CloudShellì˜ AWS CLIë¥¼ ì‚¬ìš©í•˜ì—¬ Kinesis ë°ì´í„° ìŠ¤íŠ¸ë¦¼ì— ë°ì´í„°ë¥¼ ìƒì„±í•˜ê³  ì†Œë¹„í•˜ëŠ” ë° ì„±ê³µí–ˆìŠµë‹ˆë‹¤.

This low-level approach requires managing shard iterators manually.
ì €ìˆ˜ì¤€ ì ‘ê·¼ ë°©ì‹ì€ ìƒ¤ë“œ ì´í„°ë ˆì´í„°ë¥¼ ìˆ˜ë™ìœ¼ë¡œ ê´€ë¦¬í•´ì•¼ í•©ë‹ˆë‹¤.

For more advanced consumption, consider using the Kinesis Client Library.
ë” ê³ ê¸‰ ì†Œë¹„ë¥¼ ìœ„í•´ Kinesis Client Library ì‚¬ìš©ì„ ê³ ë ¤í•˜ì„¸ìš”.

Keep the stream open as we will use it for Kinesis Data Firehose in the next lecture.
ë‹¤ìŒ ê°•ì˜ì—ì„œ Kinesis Data Firehose ì‹¤ìŠµì— ì‚¬ìš©í•˜ë¯€ë¡œ ìŠ¤íŠ¸ë¦¼ì„ ê·¸ëŒ€ë¡œ ìœ ì§€í•©ë‹ˆë‹¤.

---

## Key Takeaways

## í•µì‹¬ ìš”ì•½

* Created and configured a Kinesis Data Stream named DemoStream with one shard.

* ìƒ¤ë“œ 1ê°œë¡œ DemoStream Kinesis ë°ì´í„° ìŠ¤íŠ¸ë¦¼ ìƒì„± ë° êµ¬ì„± ì™„ë£Œ.

* Explored the differences between On-demand and Provisioned modes for stream capacity.

* ìŠ¤íŠ¸ë¦¼ ìš©ëŸ‰ ëª¨ë“œì¸ ì˜¨ë””ë§¨ë“œì™€ í”„ë¡œë¹„ì €ë‹ ëª¨ë“œì˜ ì°¨ì´ì  í•™ìŠµ.

* Used AWS CLI in CloudShell to produce and consume records from the Kinesis Data Stream.

* CloudShell AWS CLIë¥¼ ì‚¬ìš©í•˜ì—¬ Kinesis ë°ì´í„° ìŠ¤íŠ¸ë¦¼ì—ì„œ ë ˆì½”ë“œ ìƒì„± ë° ì†Œë¹„.

* Demonstrated decoding base64-encoded data retrieved from the stream to verify message content.

* ìŠ¤íŠ¸ë¦¼ì—ì„œ ê°€ì ¸ì˜¨ base64 ì¸ì½”ë”© ë°ì´í„°ë¥¼ ë””ì½”ë”©í•˜ì—¬ ë©”ì‹œì§€ ë‚´ìš© ê²€ì¦.


