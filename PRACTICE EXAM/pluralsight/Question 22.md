## Question 22 
You work for an online retailer where any downtime can result in significant loss of revenue. Your application is deployed on an Auto Scaling group of Amazon Elastic Compute Cloud (EC2) instances behind a load balancer. You have used AWS CloudFormation to deploy your resources. The Auto Scaling group is using default settings and a simple CPU utilization scaling policy, spanning multiple Availability Zones for high availability. The load balancer performs health checks using an HTML file generated by a script. During load testing, you observe in Amazon CloudWatch that the load balancer is not sending traffic to one of the Amazon EC2 instances. What could be the cause?

Correct Answers
Selected
The Amazon Elastic Compute Cloud (EC2) instance has failed the load balancer health check.

Rationale: If an Amazon EC2 instance fails the health check configured by the load balancer, it is automatically marked as unhealthy and removed from the target set, so no traffic is routed to that instance.

Incorrect Answers
The instance has not been registered with Amazon CloudWatch.

Rationale: Registration with Amazon CloudWatch is not required for an Amazon EC2 instance to receive traffic from a load balancer. CloudWatch is a monitoring tool, not part of routing or registration logic.

The Amazon Elastic Compute Cloud (EC2) instance has failed Amazon EC2 status checks.

Rationale: Failing Amazon EC2 status checks would cause the instance to be replaced by the Auto Scaling group. Instances failing only EC2 status checks are typically terminated and replaced, not just deregistered from traffic by the load balancer.

You are load testing at a moderate traffic level and not all instances are needed.

Rationale: Even at moderate traffic levels, the load balancer distributes requests among all healthy registered instances. The number of needed instances does not prevent traffic from being routed to any healthy instance.

이 문제는 **“누가 트래픽을 차단할 수 있는 권한을 가지는가”**를 묻는 전형적인 **책임 분리 판단 문제**야.
핵심은 **로드밸런서 · 오토스케일링 · EC2 상태 체크의 역할을 명확히 구분**하는 것이다.

---

# 🔑 Question 22 판단기준 (Load Balancer 트래픽 제외 원인)

## 1️⃣ 문제에서 먼저 잡아야 할 **결정 신호**

문제의 핵심 단어들을 압축해 보자:

* **Auto Scaling group**
* **behind a load balancer**
* **multiple Availability Zones**
* **load balancer health checks**
* **CloudWatch에서 특정 EC2로 트래픽 미전달 관측**

👉 여기서 중요한 포인트는:

> **“인스턴스가 존재하는데, 로드밸런서가 트래픽을 안 보낸다”**

이 말은 곧:

* 인스턴스는 살아 있음
* 하지만 **로드밸런서 관점에서는 ‘사용 불가(unhealthy)’**라는 뜻이다.

---

## 2️⃣ 1차 판단 분기: “제외 주체가 누구인가?”

### 아주 중요한 구분

> **트래픽 제외 권한은 ‘로드밸런서’만 가진다.**

* Auto Scaling → 인스턴스 **생성/종료**
* EC2 Status Check → 인스턴스 **존재 여부**
* CloudWatch → **관측만 함**
* **Load Balancer → 트래픽 라우팅 여부 결정**

👉 **트래픽이 안 간다 = 로드밸런서 판단**

---

## 3️⃣ 정답으로 가는 핵심 판단 공식

### ✅ 판단 공식

> **“EC2는 살아 있는데 트래픽이 안 간다 = 로드밸런서 헬스체크 실패”**

이 문제는 이 한 줄로 끝난다.

---

## 4️⃣ 왜 정답이 “Load Balancer health check 실패”인가?

### 🔍 로드밸런서의 동작 원리

* 로드밸런서는 주기적으로:

  * 지정된 **경로(HTML 파일)**
  * 지정된 **포트/프로토콜**
* 정상 응답(예: HTTP 200)을 못 받으면:

  * 인스턴스를 **unhealthy**로 표시
  * **트래픽 즉시 중단**

문제에서:

* 헬스체크는 **스크립트가 생성한 HTML 파일**
* 로드 테스트 중 → 타이밍/파일 생성 문제 가능

👉 가장 직접적인 원인 = **헬스체크 실패**

---

## 5️⃣ 오답들이 왜 탈락하는지 (판단 기준)

### ❌ CloudWatch 등록 여부

**판단 기준**

> “CloudWatch는 모니터링, 라우팅 아님”

* CloudWatch는:

  * 지표 수집
  * 알람
* **트래픽 전달과 무관**

👉 **CloudWatch가 트래픽을 막을 수 없다**

---

### ❌ EC2 Status Check 실패

**판단 기준**

> “EC2 상태 체크 실패 = ASG가 인스턴스를 교체”

* Status check 실패 시:

  * 인스턴스는 보통 **terminated**
  * 새 인스턴스로 대체

문제에서는:

* 인스턴스가 여전히 관측됨
* 단지 트래픽만 안 감

👉 **상태 체크 실패면 ‘존재 자체가 사라짐’**

---

### ❌ 트래픽이 적어서 안 씀

**판단 기준**

> “로드밸런서는 ‘필요한 만큼만’ 쓰지 않는다”

* 로드밸런서는:

  * **모든 healthy target에 분산**
* 트래픽 양과 무관

👉 **healthy면 반드시 트래픽을 받는다**

---

## 6️⃣ 시험장에서 바로 쓰는 초압축 판단 카드

시험 중 이렇게 생각하면 된다:

1. 인스턴스 있음
2. 트래픽 안 감
3. 로드밸런서 뒤

➡ **헬스체크 실패**

그리고 즉시 제거:

* CloudWatch
* EC2 상태 체크
* “트래픽이 적어서”

---

## 7️⃣ 이 문제의 상위 메타 규칙 (아주 중요)

> **“AWS에서 ‘트래픽 제외’는 항상 로드밸런서의 판단이다.”**

* 로드밸런서 → health check
* ASG → 생명주기
* CloudWatch → 관측

👉 **역할 혼동이 나오면 오답**

---

## 8️⃣ 한 줄 요약

> **“EC2는 살아 있는데 트래픽이 안 간다 = 로드밸런서 헬스체크 실패”**

이 문장이 자동으로 떠오르면,
이 문제는 **즉시 정답 확정**이다.

---

원하면 다음으로:

* 🔥 **ALB/NLB 헬스체크 실패 시 시나리오별 증상표**
* 🔥 **ASG vs Load Balancer 책임 분리 문제 모음**
* 🔥 **헬스체크 경로/응답 코드 함정 정리**

중에서 바로 이어서 정리해줄게.
